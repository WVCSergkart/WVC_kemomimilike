<?xml version="1.0" encoding="utf-8"?>
<Patch>
	<Operation Class="XmlExtensions.FindMod">
		<mods>
			<li>ceteam.combatextended</li>
		</mods>
		<packageId>true</packageId>
		<caseTrue>

			<!-- <Operation Class="XmlExtensions.OptionalPatch"> -->
				<!-- <modId>honkai.girls.sergkart</modId> -->
				<!-- <key>DisableWeapons_WVC</key> -->
				<!-- <defaultValue>false</defaultValue> -->
				<!-- <caseFalse> -->

					<!-- <Operation Class="XmlExtensions.ApplyPatch"> -->
						<!-- <patchName>WVC_Patch_SemiAutoWeaponCE</patchName> -->
						<!-- <arguments> -->
							<!-- <li>MeleeBladelink_WVC</li> -->
							<!-- <li>ThingDef</li> -->
						<!-- </arguments> -->
					<!-- </Operation> -->

				<!-- </caseFalse> -->
			<!-- </Operation> -->

			<Operation Class="PatchOperationAttributeSet">
				<xpath>Defs/ThingDef[@ParentName="Marker_OneHandWeapon_WVC" or @ParentName="Marker_TwoHandWeapon_WVC"]/tools/li</xpath>
				<attribute>Class</attribute>
				<value>CombatExtended.ToolCE</value>
			</Operation>
			<Operation Class="XmlExtensions.PatchOperationSafeRemove">
				<xpath>Defs/ThingDef[@ParentName="Marker_OneHandWeapon_WVC" or @ParentName="Marker_TwoHandWeapon_WVC"]/tools/li/armorPenetration</xpath>
			</Operation>
			<Operation Class="PatchOperationAdd">
				<xpath>Defs/ThingDef[@ParentName="Marker_OneHandWeapon_WVC" or @ParentName="Marker_TwoHandWeapon_WVC"]/tools/li[label="handle"]</xpath>
				<value>
					<linkedBodyPartsGroup>Handle</linkedBodyPartsGroup>
					<!-- <armorPenetrationBlunt>0.1</armorPenetrationBlunt> -->
					<!-- <armorPenetrationSharp>0.1</armorPenetrationSharp> -->
				</value>
			</Operation>
			<Operation Class="PatchOperationAdd">
				<xpath>Defs/ThingDef[@ParentName="Marker_OneHandWeapon_WVC" or @ParentName="Marker_TwoHandWeapon_WVC"]/tools/li[label="blade"]</xpath>
				<value>
					<linkedBodyPartsGroup>Blade</linkedBodyPartsGroup>
					<armorPenetrationBlunt>0.4</armorPenetrationBlunt>
					<armorPenetrationSharp>0.7</armorPenetrationSharp>
				</value>
			</Operation>
			<Operation Class="PatchOperationAdd">
				<xpath>Defs/ThingDef[@ParentName="Marker_OneHandWeapon_WVC" or @ParentName="Marker_TwoHandWeapon_WVC"]/tools/li[label="edge"]</xpath>
				<value>
					<linkedBodyPartsGroup>Edge</linkedBodyPartsGroup>
					<armorPenetrationBlunt>0.3</armorPenetrationBlunt>
					<armorPenetrationSharp>0.6</armorPenetrationSharp>
				</value>
			</Operation>

			<!-- ===================================================================== -->

			<Operation Class="PatchOperationAttributeSet">
				<xpath>Defs/ThingDef[@Name="GeneralThing_BaseValkyrie_WVC" or @Name="DryadsThingWVC" or defName="AbyssDryad_Wolf_WVC"]/tools/li</xpath>
				<attribute>Class</attribute>
				<value>CombatExtended.ToolCE</value>
			</Operation>
			<Operation Class="PatchOperationAttributeSet">
				<xpath>Defs/AlienRace.ThingDef_AlienRace[@Name="BaseHerrscher_WVC"]/tools/li</xpath>
				<attribute>Class</attribute>
				<value>CombatExtended.ToolCE</value>
			</Operation>
			<Operation Class="PatchOperationAttributeSet">
				<xpath>Defs/HediffDef[defName="WVC_HediffMutation_Corruption" or defName="PsychicClaws_WVC" or defName="WVC_HediffMutation_TailArm" or @Name="WVC_Hediff_BodyPart_Mechanite"]/comps/li/tools/li</xpath>
				<attribute>Class</attribute>
				<value>CombatExtended.ToolCE</value>
			</Operation>

			<Operation Class="PatchOperationReplace">
				<xpath>Defs/ThingDef[@Name="GeneralThing_BaseValkyrie_WVC" or @Name="DryadsThingWVC" or @Name="BaseHerrscher_WVC"]/tools/li/armorPenetration</xpath>
				<value>
					<armorPenetrationBlunt>0.3</armorPenetrationBlunt>
				</value>
			</Operation>
			<Operation Class="PatchOperationReplace">
				<xpath>Defs/ThingDef[defName="AbyssDryad_Wolf_WVC"]/tools/li/armorPenetration</xpath>
				<value>
					<armorPenetrationSharp>0.7</armorPenetrationSharp>
					<armorPenetrationBlunt>0.2</armorPenetrationBlunt>
				</value>
			</Operation>
			<!-- <Operation Class="PatchOperationReplace"> -->
				<!-- <xpath>Defs/AlienRace.ThingDef_AlienRace[defName="Alien_Herrscher_HoS_WVC"]/tools/li/armorPenetration</xpath> -->
				<!-- <value> -->
					<!-- <armorPenetrationSharp>0.7</armorPenetrationSharp> -->
					<!-- <armorPenetrationBlunt>0.4</armorPenetrationBlunt> -->
				<!-- </value> -->
			<!-- </Operation> -->
			<Operation Class="PatchOperationReplace">
				<xpath>Defs/HediffDef[defName="WVC_HediffMutation_Corruption" or defName="PsychicClaws_WVC"]/comps/li/tools/li/armorPenetration</xpath>
				<value>
					<armorPenetrationSharp>0.7</armorPenetrationSharp>
					<armorPenetrationBlunt>0.2</armorPenetrationBlunt>
				</value>
			</Operation>

			<!-- ===================================================================== -->

			<!-- Needed for KLA -->
			<Operation Class="XmlExtensions.PatchOperationSafeRemove">
				<xpath>/Defs/ThingDef[@ParentName="HonkaiThingWVC"]/verbs</xpath>
			</Operation>

		</caseTrue>
		<caseFalse>

			<!-- ===================================================================== -->

			<li Class="XmlExtensions.OptionalPatch">
				<modId>honkai.girls.sergkart</modId>
				<key>Valkyries_Ranged_MeleeWeapon_WVC</key>
				<defaultValue>false</defaultValue>
				<caseTrue>
					<!-- 1 hand -->
					<Operation Class="XmlExtensions.PatchOperationSafeAdd">
						<xpath>/Defs/ThingDef[@Name="Marker_OneHandWeapon_WVC"]</xpath>
						<safetyDepth>1</safetyDepth>
						<value>
							<statBases>
							  <AccuracyTouch>0.90</AccuracyTouch>
							  <AccuracyShort>0.65</AccuracyShort>
							  <AccuracyMedium>0.35</AccuracyMedium>
							  <AccuracyLong>0.15</AccuracyLong>
							  <RangedWeapon_Cooldown>1.1</RangedWeapon_Cooldown>
							</statBases>
							<verbs>
								<li>
									<verbClass>Verb_Shoot</verbClass>
									<hasStandardCommand>true</hasStandardCommand>
									<warmupTime>1.0</warmupTime>
									<burstShotCount>3</burstShotCount>
									<ticksBetweenBurstShots>7</ticksBetweenBurstShots>
									<minRange>0</minRange>
									<range>19.9</range>
									<defaultProjectile>Projectile_RangeSlash_WVC</defaultProjectile>
									<soundCast>Pawn_Melee_MechanoidSlash_Miss</soundCast>
									<muzzleFlashScale>9</muzzleFlashScale>
								</li>
							</verbs>
						</value>
					</Operation>
					<!-- 2 hand -->
					<Operation Class="XmlExtensions.PatchOperationSafeAdd">
						<xpath>/Defs/ThingDef[@Name="Marker_TwoHandWeapon_WVC"]</xpath>
						<safetyDepth>1</safetyDepth>
						<value>
							<statBases>
							  <AccuracyTouch>0.90</AccuracyTouch>
							  <AccuracyShort>0.65</AccuracyShort>
							  <AccuracyMedium>0.35</AccuracyMedium>
							  <AccuracyLong>0.15</AccuracyLong>
							  <RangedWeapon_Cooldown>1.2</RangedWeapon_Cooldown>
							</statBases>
							<verbs>
								<li>
									<verbClass>Verb_Shoot</verbClass>
									<hasStandardCommand>true</hasStandardCommand>
									<warmupTime>1.0</warmupTime>
									<burstShotCount>3</burstShotCount>
									<ticksBetweenBurstShots>7</ticksBetweenBurstShots>
									<minRange>0</minRange>
									<range>21.9</range>
									<defaultProjectile>Projectile_RangeSlash_WVC</defaultProjectile>
									<soundCast>Pawn_Melee_MechanoidSlash_Miss</soundCast>
									<muzzleFlashScale>9</muzzleFlashScale>
								</li>
							</verbs>
						</value>
					</Operation>
				</caseTrue>
			</li>

			<!-- ===================================================================== -->

			<li Class="XmlExtensions.OptionalPatch">
				<modId>honkai.girls.sergkart</modId>
				<key>Valkyries_RemoveDodgeLimit_WVC</key>
				<defaultValue>false</defaultValue>
				<caseTrue>
					<Operation Class="PatchOperationReplace">
					  <xpath>/Defs/StatDef[defName="MeleeDodgeChance"]/postProcessCurve</xpath>
					  <value>
						<postProcessCurve>
						  <points>
							<li>(5, 0)</li>
							<li>(20, 0.30)</li>
							<li>(60, 0.50)</li>
							<li>(100, 0.70)</li>
							<li>(150, 0.90)</li>
							<li>(250, 0.95)</li>
							<li>(500, 1.00)</li>
						  </points>
						</postProcessCurve>
					  </value>
					</Operation>
				</caseTrue>
			</li>

			<!-- ===================================================================== -->

		</caseFalse>
	</Operation>
</Patch>